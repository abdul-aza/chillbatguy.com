<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solana Web App</title>
    
    <!-- Include Tailwind CSS for styling -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.js"></script>
    
    <!-- Include Solana Web3 library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/solana-web3.js/1.87.6/index.min.js"></script>

    <style>
        .log-container {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .success { color: #10B981; }
        .error { color: #EF4444; }
        .info { color: #3B82F6; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-2xl mx-auto bg-white rounded-lg shadow-lg p-6">
            <!-- Header -->
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800 mb-2">Solana Web App</h1>
                <p class="text-gray-600">Connect your Phantom wallet to get started</p>
            </div>

            <!-- Wallet Connection Section -->
            <div class="flex flex-col items-center gap-4 mb-8">
                <div id="wallet-status" class="text-center mb-4">
                    <!-- Wallet status will be displayed here -->
                </div>
                <button id="connect-button" 
                        class="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors">
                    Connect Phantom Wallet
                </button>
                <button id="disconnect-button" 
                        class="hidden bg-red-500 text-white px-6 py-2 rounded-lg hover:bg-red-600 transition-colors">
                    Disconnect Wallet
                </button>
            </div>

            <!-- Transaction Section -->
            <div id="transaction-section" class="hidden mb-8">
                <div class="text-center">
                    <button id="transaction-button" 
                            class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        Send Test Transaction
                    </button>
                </div>
            </div>

            <!-- Activity Log -->
            <div class="border rounded-lg p-4">
                <h2 class="text-xl font-semibold mb-4">Activity Log</h2>
                <div id="log-container" class="log-container space-y-2">
                    <!-- Logs will be displayed here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Main application logic
        class SolanaApp {
            constructor() {
                this.provider = null;
                this.publicKey = null;
                this.connection = null;
                
                // Initialize UI elements
                this.connectButton = document.getElementById('connect-button');
                this.disconnectButton = document.getElementById('disconnect-button');
                this.transactionButton = document.getElementById('transaction-button');
                this.walletStatus = document.getElementById('wallet-status');
                this.transactionSection = document.getElementById('transaction-section');
                this.logContainer = document.getElementById('log-container');

                // Bind event handlers
                this.connectButton.addEventListener('click', () => this.connectWallet());
                this.disconnectButton.addEventListener('click', () => this.disconnectWallet());
                this.transactionButton.addEventListener('click', () => this.sendTestTransaction());

                // Initialize the app
                this.initialize();
            }

            async initialize() {
                // Check if Phantom is installed
                if ('phantom' in window) {
                    this.provider = window.phantom?.solana;
                    
                    if (this.provider?.isPhantom) {
                        this.addLog('info', 'Phantom wallet detected');
                        this.connection = new solanaWeb3.Connection(
                            'https://api.mainnet-beta.solana.com'
                        );
                    } else {
                        this.addLog('error', 'Phantom wallet not found');
                    }
                }

                // Setup wallet change listeners
                if (this.provider) {
                    this.provider.on('connect', (publicKey) => {
                        this.publicKey = publicKey;
                        this.updateUI(true);
                        this.addLog('success', `Connected to wallet: ${publicKey.toBase58().slice(0, 10)}...`);
                    });

                    this.provider.on('disconnect', () => {
                        this.publicKey = null;
                        this.updateUI(false);
                        this.addLog('info', 'Wallet disconnected');
                    });
                }
            }

            async connectWallet() {
                try {
                    if (!this.provider) {
                        window.open('https://phantom.app/', '_blank');
                        return;
                    }

                    await this.provider.connect();
                } catch (error) {
                    this.addLog('error', `Connection failed: ${error.message}`);
                }
            }

            async disconnectWallet() {
                try {
                    await this.provider.disconnect();
                } catch (error) {
                    this.addLog('error', `Disconnect failed: ${error.message}`);
                }
            }

            async sendTestTransaction() {
                if (!this.publicKey) {
                    this.addLog('error', 'Please connect your wallet first');
                    return;
                }

                try {
                    this.addLog('info', 'Creating test transaction...');
                    
                    // Create a simple SOL transfer transaction (sending 0 SOL to self)
                    const transaction = new solanaWeb3.Transaction().add(
                        solanaWeb3.SystemProgram.transfer({
                            fromPubkey: this.publicKey,
                            toPubkey: this.publicKey,
                            lamports: 0
                        })
                    );

                    // Get the latest blockhash
                    const blockhash = await this.connection.getLatestBlockhash();
                    transaction.recentBlockhash = blockhash.blockhash;
                    transaction.feePayer = this.publicKey;

                    // Request signature from user
                    const signed = await this.provider.signTransaction(transaction);
                    this.addLog('info', 'Transaction signed, sending...');

                    // Send the transaction
                    const signature = await this.connection.sendRawTransaction(signed.serialize());
                    this.addLog('info', `Transaction sent: ${signature}`);

                    // Confirm transaction
                    await this.connection.confirmTransaction(signature);
                    this.addLog('success', 'Transaction confirmed!');

                } catch (error) {
                    this.addLog('error', `Transaction failed: ${error.message}`);
                }
            }

            updateUI(connected) {
                this.connectButton.style.display = connected ? 'none' : 'block';
                this.disconnectButton.style.display = connected ? 'block' : 'none';
                this.transactionSection.style.display = connected ? 'block' : 'none';
                
                if (connected && this.publicKey) {
                    this.walletStatus.innerHTML = `
                        <div class="text-green-600 font-medium">
                            Connected: ${this.publicKey.toBase58().slice(0, 10)}...
                        </div>
                    `;
                } else {
                    this.walletStatus.innerHTML = `
                        <div class="text-gray-600">
                            Not connected
                        </div>
                    `;
                }
            }

            addLog(type, message) {
                const logEntry = document.createElement('div');
                logEntry.className = `${type} text-sm`;
                logEntry.innerHTML = `
                    <span class="text-gray-500">${new Date().toLocaleTimeString()}</span>
                    ${message}
                `;
                this.logContainer.appendChild(logEntry);
                this.logContainer.scrollTop = this.logContainer.scrollHeight;
            }
        }

        // Initialize the app when the page loads
        window.addEventListener('load', () => {
            new SolanaApp();
        });
    </script>
</body>
</html>
